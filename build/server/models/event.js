// Generated by CoffeeScript 1.8.0
var Event, async, convertISO, cozydb, log, momentTz;

cozydb = require('cozydb');

momentTz = require('moment-timezone');

async = require('async');

log = require('printit')({
  prefix: 'event:model'
});

module.exports = Event = cozydb.getModel('Event', {
  start: {
    type: String
  },
  end: {
    type: String
  },
  place: {
    type: String
  },
  details: {
    type: String
  },
  description: {
    type: String
  },
  rrule: {
    type: String
  },
  tags: [String],
  attendees: {
    type: [Object]
  },
  related: {
    type: String,
    "default": null
  },
  timezone: {
    type: String
  },
  alarms: {
    type: [Object]
  },
  created: {
    type: String
  },
  lastModification: {
    type: String
  }
});

Event.dateFormat = 'YYYY-MM-DD';

Event.ambiguousDTFormat = 'YYYY-MM-DD[T]HH:mm:00.000';

Event.utcDTFormat = 'YYYY-MM-DD[T]HH:mm:00.000[Z]';

Event.alarmTriggRegex = /(\+?|-)PT?(\d+)(W|D|H|M|S)/;

convertISO = function(dateTimeTimezoned) {
  if (!dateTimeTimezoned) {
    return false;
  }
  return new Date(dateTimeTimezoned).toISOString();
};

Event.fromGoogleEvent = function(gEvent) {
  var data;
  data = {
    start: convertISO(gEvent.start.dateTime) || gEvent.start.date,
    end: convertISO(gEvent.end.dateTime) || gEvent.end.date,
    timezone: gEvent.start.timezone || gEvent.end.timezone,
    place: gEvent.location,
    details: gEvent.description,
    description: gEvent.summary
  };
  if (gEvent.recurrence) {
    data.rrule = gEvent.recurrence[0].substring("RRULE:".length);
  }
  return data;
};

Event.validGoogleEvent = function(gEvent) {
  var valid, _ref, _ref1, _ref2, _ref3;
  return valid = ((((_ref = gEvent.start) != null ? _ref.dateTime : void 0) != null) || (((_ref1 = gEvent.start) != null ? _ref1.date : void 0) != null)) && ((((_ref2 = gEvent.end) != null ? _ref2.dateTime : void 0) != null) || (((_ref3 = gEvent.end) != null ? _ref3.date : void 0) != null)) && (gEvent.summary != null);
};
