// Generated by CoffeeScript 1.9.3
var americano, config, fs, localizationManager, log, path, realtimer, useBuildView;

americano = require('americano');

fs = require('fs');

path = require('path');

realtimer = require('./utils/realtimer');

log = require('printit')({
  date: true,
  prefix: 'config'
});

localizationManager = require('./utils/localization_manager');

useBuildView = fs.existsSync(path.resolve(__dirname, 'views', 'index.js'));

config = {
  common: {
    set: {
      'view engine': useBuildView ? 'js' : 'jade',
      'views': path.resolve(__dirname, 'views')
    },
    engine: {
      js: function(path, locales, callback) {
        return callback(null, require(path)(locales));
      }
    },
    use: [
      americano.bodyParser(), americano.methodOverride(), americano.errorHandler({
        dumpExceptions: true,
        showStack: true
      }), americano["static"](path.resolve(__dirname, '../client/public'), {
        maxAge: 86400000
      })
    ],
    afterStart: function(app, server) {
      var sio;
      sio = require('socket.io');
      app.io = sio(server);
      app.io.on('connection', function(socket) {
        return realtimer.set(socket);
      });
      return localizationManager.initialize(function() {
        return log.info("LocalizationManager initialized");
      });
    }
  },
  development: [americano.logger('dev')],
  production: [americano.logger('short')],
  plugins: ['cozydb']
};

module.exports = config;
